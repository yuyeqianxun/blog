# HTTP

### HTTP概念
HTTP协议（HyperText Transfer Protocol，超文本传输协议）是因特网上应用最为广泛的一种网络传输协议，所有的WWW文件都必须遵守这个标准。
HTTP基于TCP/IP通信协议来传递数据（HTML 文件, 图片文件, 查询结果等）。
默认使用端口80。

### HTTP特点
- 无连接: 限制每次连接只处理一个请求,服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。
- 无状态: 协议对于事务处理没有记忆能力,缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。
- 媒体独立: 只要客户端和服务器知道如何处理的数据内容，任何类型的数据都可以通过HTTP发送。客户端以及服务器指定使用适合的MIME-type内容类型。

### HTTP报文

#### 请求
> 请求行 + 请求头 + 空行 + 请求体(数据)

![请求报文](https://note.youdao.com/yws/public/resource/fefa04f064f159e4a063a61949288b11/xmlnote/0D10DC1BCED34C3A9194873B40CF7078/14985)
```
GET /hello.txt HTTP/1.1
User-Agent: curl/7.16.3 libcurl/7.16.3 OpenSSL/0.9.7l zlib/1.2.3
Host: www.example.com
Accept-Language: en, mi
```

#### 请求头
| 通用字段   | 作用 |
| ---------- | ------------ |
| Cache-Control | 控制缓存的行为 |
| Connection | 连接管理(keep-alive) |
| Date | 创建报文时间 |
| Pragma | 报文指令,相当于catch-control:no-cache |
| Via | 代理服务器相关信息 |
| Transfer-Encoding | 传输编码方式 |
| Upgrade | 要求客户端升级协议 |
| Warning | 在内容中可能存在错误 |

| 请求字段   | 作用 |
| ---------- | ------------ |
| Accept | 能正确接收的媒体类型 |
| Accept-Charset | 能正确接收的字符集 |
| Accept-Encoding | 能正确接收的编码格式列表 |
| Accept-Language | 能正确接收的语言列表 |
| Expect | 期待服务端的指定行为 |
| From | 请求方邮箱地址 |
| Host | 服务器的域名 |
| If-Match | 两端资源标记比较 |
| If-Modified-Since | 本地资源未修改返回 304（比较时间） |
| If-None-Match | 本地资源未修改返回 304（比较标记） |
| User-Agent | 客户端信息 |
| Max-Forwards | 限制可被代理及网关转发的次数 |
| Proxy-Authorization | 向代理服务器发送验证信息 |
| Range | 请求某个内容的一部分 |
| Referer | 页面来源，来源方的url |
| TE | 传输编码优先级 |

##### 请求方式
- GET: 通常用来获取资源
- HEAD: 获取资源的元信息
- POST: 提交数据，即上传数据
- PUT: 修改数据
- OPTIONS: 试探请求，用于复杂请求
- DELETE: 删除资源(几乎用不到)
- CONNECT: 建立连接隧道，用于代理服务器
- TRACE: 追踪请求-响应的传输路径

##### GET和POST区别
- 缓存：GET会缓存，POST不会，除非主动设置
- 无害：GET刷新、后退无害，POST会再次提交请求
- 记录：GET参数会完整的保留在浏览记录，能被添加书签，POST参数不能
- 限制：GETurl限制长度，且只允许ASCII字符，POST无限制
- 参数：GET通过url传参，安全风险高，POST通过请求体，安全风险低
- 特性：GET幂等(指同一个请求方法执行多次和仅执行一次的效果完全相同)，POST不是
- 请求：GET只发一个TCP，POST复杂请求发两个

### 响应
> 状态行 + 响应头 + 空行 + 响应正文

![响应报文](http://note.youdao.com/yws/public/resource/fefa04f064f159e4a063a61949288b11/xmlnote/3DA641EC65CE4158AB6A7178A2BBFA2E/14987)
```
HTTP/1.1 200 OK
Date: Mon, 27 Jul 2009 12:28:53 GMT
Server: Apache
Last-Modified: Wed, 22 Jul 2009 19:15:56 GMT
ETag: "34aa387-d-1568eb00"
Accept-Ranges: bytes
Content-Length: 51
Vary: Accept-Encoding
Content-Type: text/plain
```

### URI
URI 在于I(Identifier)是统一资源标示符，可以唯一标识一个资源。
URL在于Locater，一般来说（URL）统一资源定位符，可以提供找到该资源的路径，因为它可以标识一个资源，所以URL又是URI的子集。
![请求报文](https://note.youdao.com/yws/public/resource/fefa04f064f159e4a063a61949288b11/xmlnote/14F1478B589A4C13985F41191E42C2C2/14989)

**scheme** 协议名，比如http, https, file等等。后面必须和://连在一起。
**user:passwd@** 表示登录主机时的用户信息，不过很不安全，不推荐使用，也不常用。
**host:port** 表示主机名和端口。
**path** 表示请求路径，标记资源所在位置。
**query** 表示查询参数，为key=val这种形式，多个键值对之间用&隔开。
**fragment** 表示 URI 所定位的资源内的一个锚点，浏览器可以根据这个锚点跳转到对应的位置。

### 状态码
- 1xx: 指示信息--表示请求已接收，继续处理
- 2xx: 成功--表示请求已被成功接收、理解、接受
- 3xx: 重定向--要完成请求必须进行更进一步的操作
- 4xx: 客户端错误--请求有语法错误或请求无法实现
- 5xx: 服务器端错误--服务器未能实现合法的请求

#### 常见状态码
100——客户必须继续发出请求(常见options请求)
101——客户要求服务器根据请求转换HTTP协议版本，websocket成功状态码
301——永久性重定向
302——临时性重定向
304——客户端已经执行了GET，但文件未变化，有缓存
400——请求报文存在语法错误
401——发送的请求需要有通过 HTTP 认证的认证信息
403——请求资源的访问被服务器拒绝
404——服务器没有找到请求的资源
500——服务器端在执行请求时发生了错误
503——表明服务器暂时处于超负载或正在停机维护，无法处理请求

# HTTPS
超文本传输安全协议，（英语：Hypertext Transfer Protocol Secure，缩写：HTTPS，常称为HTTP over TLS，HTTP over SSL或HTTP Secure）是一种网络安全传输协议。
HTTPS = HTTP + SSL/TLS；SSL 即安全套接层，TLS1.0 = SSL3.1，目前主流是TLS1.2版本

### 工作原理
![工作原理](https://note.youdao.com/yws/public/resource/fefa04f064f159e4a063a61949288b11/xmlnote/DAFCFD7F3C5F414EA3A2BEC8011BA323/14992)

- 浏览器将自己支持的一套加密规则发送给服务器。 
- 服务器从中选出一组加密算法与HASH算法，并将自己的身份信息以证书的形式发回给浏览器。证书里面包含了服务器地址，加密公钥，以及证书的颁发机构等信息。  
- 浏览器获得服务器证书之后浏览器要做以下工作： 
  - 验证证书的合法性（颁发证书的机构是否合法，证书中包含的网站地址是否与正在访问的地址一致等），如果证书受信任，则浏览器栏里面会显示一个小锁头，否则会给出证书不受信的提示。 
  - 如果证书受信任，或者是用户接受了不受信的证书，浏览器会生成一串随机数的密码，并用证书中提供的公钥加密。 
  - 使用约定好的HASH算法计算握手消息，并使用生成的随机数对消息进行加密，最后将之前生成的所有信息发送给网站。 
- 网站接收浏览器发来的数据之后要做以下的操作： 
  - 使用自己的私钥将信息解密取出密码，使用密码解密浏览器发来的握手消息，并验证HASH是否与浏览器发来的一致。 
  - 使用密码加密一段握手消息，发送给浏览器。 
- 浏览器解密并计算握手消息的HASH，如果与服务端发来的HASH一致，此时握手过程结束，之后所有的通信数据将由之前浏览器生成的随机密码并利用对称加密算法进行加密。

#### HTTPS解决方案
- 非对称加密：服务端生成私钥，提供公钥给客户端（RSA，DSA/DSS）
- 对称加密：客户端生成密码，在通过公钥加密，防止密码被中途截获，服务器通过私钥解密，双方共持相同密码（AES，RC4，3DES）
- 数字签名：通信工程中对发送内容进行HASH计算(MD5码)，并使用对称密码加密，另一方通过密码解密，再计算HASH值是否相同，验证内容完整性（MD5，SHA1，SHA256）

#### 数字证书
数字证书认证机构处于客户端与服务器双方都可信赖的第三方机构的立场上。用于解决身份伪装的问题。

#### TSL1.3
1. 增加安全性，废除了有漏洞的加密算法
2. 优化性能，1.3更快

# HTTP2
### HTTP1.1缺点
- 明文通信，安全性不足
- 不验证通信方的身份，因此有可能遭遇伪装
- 无法证明报文的完整性，有可能已遭篡改
- 无状态，每次需要传输巨大的头部信息
- 基于TCP，而TCP最大限制6个，每个请求都需要单独链接，占用一个TCP，多了会造成资源堵塞
- 不支持服务器推送消息

### HTTP2改进
1. 头部压缩
HPACK 使用2个索引表(静态索引表和动态索引表)来把头部映射到索引值，并对不存在的头部使用 huffman 编码，并动态缓存到索引，从而达到压缩头部的效果。HPACK 中有2个索引表，分别是静态索引表和动态索引表。

2. 多路复用
在 HTTP 2.0 中，有两个非常重要的概念，分别是帧（frame）和流（stream）。
帧代表着最小的数据单位，每个帧会标识出该帧属于哪个流，流也就是多个帧组成的数据流。
多路复用，就是在一个 TCP 连接中可以存在多条流。换句话说，也就是可以发送多个请求，对端可以通过帧中的标识知道属于哪个请求。通过这个技术，可以避免 HTTP 旧版本中的队头阻塞问题，极大的提高传输性能。

3. 二进制分帧
以二进制方式传输和Header 压缩。HTTP/2 将请求和响应数据分割为更小的帧，并且它们采用二进制编码。多个帧之间可以乱序发送，根据帧首部的流标识可以重新组装。
它把TCP协议的部分特性挪到了应用层，把原来的"Header+Body"的消息"打散"为数个小片的二进制"帧"(Frame),用"HEADERS"帧存放头数据、"DATA"帧存放实体数据。HTP/2数据分帧后"Header+Body"的报文结构就完全消失了，协议看到的只是一个个的"碎片"。

4. Server Push
HTTP2还在一定程度上改变了传统的“请求-应答”工作模式，服务器不再是完全被动地响应请求，也可以新建“流”主动向客户端发送消息。比如，在浏览器刚请求HTML的时候就提前把可能会用到的JS、CSS文件发给客户端，减少等待的延迟，这被称为"服务器推送"

### 三者的关系与区别
![关系图](https://note.youdao.com/yws/public/resource/fefa04f064f159e4a063a61949288b11/xmlnote/E5A22BEA4F3647D59608F038AD8608E0/14994)
